{% extends "iam/login.html.j2" %}
{% set principal=form.principal.value() %}
{% set iam_public_realm=True %}


{% block main_content %}
<div class="row">
  <div class="col mx-auto w-100">
    {% if state == 'challenged' and form.is_valid() %}
    <p>
      {{ _("We sent a challenge to %(principal)s.",
        principal=('<strong>'+principal+'</strong>')|safe) }}
      {{ _('Enter the code you received in the input field below.') }}
    </p>
    <form action="{{ url(iam_urls.login_token) }}{{ next_url }}" method="POST">{{ csrf_input }}
      <input name="principal"
        required="true"
        type="hidden"
        value="{{ form.principal.value() }}"
      >
      <div class="form-group">
        <input name="code"
          required="true"
          type="number"
          class="form-control"
          placeholder="{{ _('Code') }}"
        >
        <small class="form-text">{{ _("Enter the six-digit code that you received.") }}</small>
      </div>
      <button type="submit" class="btn btn-primary w-100">
        {{ _('Continue') }}
      </button>
    </form>
    {% else %}
    <p>
      {{ _('Enter your email address or phonenumber to receive instructions on resetting your account password.') }}
    </p>
    <form action="" method="POST">{{ csrf_input }}
      <div class="form-group">
        <input name="principal"
          required="true"
          class="form-control{% if form.principal.errors %} is-invalid{% endif %}"
          placeholder="{{ iam_principals_placeholder }}"
          {% if form.principal.value() %}
          value="{{ form.principal.value() }}"
          {% endif %}
        >
        {% if form.principal.errors %}
        <p class="invalid-feedback">{{ _("Please enter a valid email address or phonenumber.") }}</p>
        {% else %}
        <small class="form-text">{{ _("We will send a challenge to the email address or phonenumber you provide.") }}</small>
        {% endif %}
      </div>
      <button type="submit" class="btn btn-primary w-100">
        {{ _('Continue') }}
      </button>
    </form>
    {% endif %}
  </div>
</div>
<hr/>
<div class="row mb-1">
  <div class="col mx-auto">
    <a href="{{ url(iam_urls.login) }}{{ next_url }}"
      class="btn btn-outline-primary w-100" role="button">
      <i class="fas fa-angle-left"></i> {{ _("Return to login options") }}
    </a>
  </div>
</div>
{% endblock %}
