/*
 * Copyright (c) 2020. - Arash Hatami
 */

!function(){var e,t,n;!function(i){function o(e,t){return x.call(e,t)}function r(e,t){var n,i,o,r,a,s,u,c,f,l,p,d,m=t&&t.split("/"),h=y.map,v=h&&h["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,y.nodeIdCompat&&N.test(e[a])&&(e[a]=e[a].replace(N,"")),"."===e[0].charAt(0)&&m&&(d=m.slice(0,m.length-1),e=d.concat(e)),f=0;f<e.length;f++)if("."===(p=e[f]))e.splice(f,1),f-=1;else if(".."===p){if(0===f||1===f&&".."===e[2]||".."===e[f-1])continue;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}if((m||v)&&h){for(n=e.split("/"),f=n.length;f>0;f-=1){if(i=n.slice(0,f).join("/"),m)for(l=m.length;l>0;l-=1)if((o=h[m.slice(0,l).join("/")])&&(o=o[i])){r=o,s=f;break}if(r)break;!u&&v&&v[i]&&(u=v[i],c=f)}!r&&u&&(r=u,s=c),r&&(n.splice(0,s,r),e=n.join("/"))}return e}function a(e,t){return function(){var n=O.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),m.apply(i,n.concat([e,t]))}}function s(e){return function(t){return r(t,e)}}function u(e){return function(t){g[e]=t}}function c(e){if(o(b,e)){var t=b[e];delete b[e],w[e]=!0,d.apply(i,t)}if(!o(g,e)&&!o(w,e))throw new Error("No "+e);return g[e]}function f(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return e?f(e):[]}function p(e){return function(){return y&&y.config&&y.config[e]||{}}}var d,m,h,v,g={},b={},y={},w={},x=Object.prototype.hasOwnProperty,O=[].slice,N=/\.js$/;h=function(e,t){var n,i=f(e),o=i[0],a=t[1];return e=i[1],o&&(o=r(o,a),n=c(o)),o?e=n&&n.normalize?n.normalize(e,s(a)):r(e,a):(e=r(e,a),i=f(e),o=i[0],e=i[1],o&&(n=c(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},v={require:function(e){return a(e)},exports:function(e){var t=g[e];return void 0!==t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:p(e)}}},d=function(e,t,n,r){var s,f,p,d,m,y,x,O=[],N=typeof n;if(r=r||e,y=l(r),"undefined"===N||"function"===N){for(t=!t.length&&n.length?["require","exports","module"]:t,m=0;m<t.length;m+=1)if(d=h(t[m],y),"require"===(f=d.f))O[m]=v.require(e);else if("exports"===f)O[m]=v.exports(e),x=!0;else if("module"===f)s=O[m]=v.module(e);else if(o(g,f)||o(b,f)||o(w,f))O[m]=c(f);else{if(!d.p)throw new Error(e+" missing "+f);d.p.load(d.n,a(r,!0),u(f),{}),O[m]=g[f]}p=n?n.apply(g[e],O):void 0,e&&(s&&s.exports!==i&&s.exports!==g[e]?g[e]=s.exports:p===i&&x||(g[e]=p))}else e&&(g[e]=n)},e=t=m=function(e,t,n,o,r){if("string"==typeof e)return v[e]?v[e](t):c(h(e,l(t)).f);if(!e.splice){if(y=e,y.deps&&m(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=i}return t=t||function(){},"function"==typeof n&&(n=o,o=r),o?d(i,e,t,n):setTimeout(function(){d(i,e,t,n)},4),m},m.config=function(e){return m(e)},e._defined=g,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(g,e)||o(b,e)||(b[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("components/almond/almond",function(){}),n("app/lib/ready",[],function(){"use strict";var e=!1,t=function(t){e||(e=!0,t())};return function(e){document.addEventListener("DOMContentLoaded",function(){t(e)}),"interactive"!==document.readyState&&"complete"!==document.readyState||t(e)}}),n("app/lib/promise",[],function(){"use strict";var e=function(e){console.log(e)},t=function(){this.success=[],this.errors=[]};t.prototype.then=function(t,n){this.success.push(t),n?this.errors.push(n):this.errors.push(e)};var n=function(){this.promise=new t};n.prototype={promise:t,resolve:function(e){this.promise.success.forEach(function(t){window.setTimeout(function(){t(e)},0)})},reject:function(e){this.promise.errors.forEach(function(t){window.setTimeout(function(){t(e)},0)})}};var i=function(e,n){return e instanceof t?e.then(n):n(e)};return{defer:function(){return new n},when:i}}),n("app/globals",[],function(){"use strict";var e=function(){this.values=[]};return e.prototype.update=function(e){this.values.push((new Date).getTime()-e.getTime())},e.prototype.localTime=function(){return new Date((new Date).getTime()-this.values.reduce(function(e,t){return e+t})/this.values.length)},{offset:new e}}),n("app/api",["app/lib/promise","app/globals"],function(e,t){"use strict";for(var n,i,o=function(){return window.location.pathname},r=document.getElementsByTagName("script"),a=0;a<r.length;a++)if(r[a].hasAttribute("data-nikas")){i=r[a].getAttribute("data-nikas");break}if(!i){for(a=0;a<r.length;a++)if(r[a].getAttribute("async")||r[a].getAttribute("defer"))throw"Nikas's automatic configuration detection failed, please refer to client-configuration and add a custom `data-nikas` attribute.";n=r[r.length-1],i=n.src.substring(0,n.src.length-"/js/embed.min.js".length)}"/"===i[i.length-1]&&(i=i.substring(0,i.length-1));var s=function(e,n,i,o,r){function a(){var e=s.getResponseHeader("Date");null!==e&&t.offset.update(new Date(e));var n=s.getResponseHeader("X-Set-Cookie");n&&n.match(/^nikas-/)&&(document.cookie=n),s.status>=500?r&&r(s.body):o({status:s.status,body:s.responseText})}var s=new XMLHttpRequest;try{s.open(e,n,!0),s.withCredentials=!0,s.setRequestHeader("Content-Type","application/json"),s.onreadystatechange=function(){4===s.readyState&&a()}}catch(e){(r||console.log)(e.message)}s.send(i)},u=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&null!==e[n]&&void 0!==e[n]&&(t+=n+"="+encodeURIComponent(e[n])+"&");return t.substring(0,t.length-1)};return{endpoint:i,salt:"Eech7co8Ohloopo9Ol6baimi",create:function(t,n){var r=e.defer();return s("POST",i+"/new?"+u({uri:t||o()}),JSON.stringify(n),function(e){201===e.status||202===e.status?r.resolve(JSON.parse(e.body)):r.reject(e.body)}),r.promise},modify:function(t,n){var o=e.defer();return s("PUT",i+"/id/"+t,JSON.stringify(n),function(e){403===e.status?o.reject("Not authorized to modify this comment!"):200===e.status?o.resolve(JSON.parse(e.body)):o.reject(e.body)}),o.promise},remove:function(t){var n=e.defer();return s("DELETE",i+"/id/"+t,null,function(e){403===e.status?n.reject("Not authorized to remove this comment!"):200===e.status?n.resolve(null===JSON.parse(e.body)):n.reject(e.body)}),n.promise},view:function(t,n){var o=e.defer();return s("GET",i+"/id/"+t+"?"+u({plain:n}),null,function(e){o.resolve(JSON.parse(e.body))}),o.promise},fetch:function(t,n,r,a,c){void 0===n&&(n="inf"),void 0===r&&(r="inf"),void 0===a&&(a=null);var f={uri:t||o(),after:c,parent:a};"inf"!==n&&(f.limit=n),"inf"!==r&&(f.nested_limit=r);var l=e.defer();return s("GET",i+"/?"+u(f),null,function(e){200===e.status?l.resolve(JSON.parse(e.body)):404===e.status?l.resolve({total_replies:0}):l.reject(e.body)}),l.promise},count:function(t){var n=e.defer();return s("POST",i+"/count",JSON.stringify(t),function(e){200===e.status?n.resolve(JSON.parse(e.body)):n.reject(e.body)}),n.promise},like:function(t){var n=e.defer();return s("POST",i+"/id/"+t+"/like",null,function(e){n.resolve(JSON.parse(e.body))}),n.promise},dislike:function(t){var n=e.defer();return s("POST",i+"/id/"+t+"/dislike",null,function(e){n.resolve(JSON.parse(e.body))}),n.promise},feed:function(e){return i+"/feed?"+u({uri:e||o()})},preview:function(t){var n=e.defer();return s("POST",i+"/preview",JSON.stringify({text:t}),function(e){200===e.status?n.resolve(JSON.parse(e.body).text):n.reject(e.body)}),n.promise}}}),n("app/dom",[],function(){"use strict";function e(e){this.obj=e,this.replace=function(t){var i=n.htmlify(t);return e.parentNode.replaceChild(i.obj,e),i},this.prepend=function(t){var i=n.htmlify(t);return e.insertBefore(i.obj,e.firstChild),i},this.append=function(t){var i=n.htmlify(t);return e.appendChild(i.obj),i},this.insertAfter=function(t){var i=n.htmlify(t);return e.parentNode.insertBefore(i.obj,e.nextSibling),i},this.on=function(t,n,i){e.addEventListener(t,function(e){n(e),(void 0===i||i)&&e.preventDefault()})},this.toggle=function(e,n,i){var o=new t(n,i);this.on(e,function(){o.next()})},this.detach=function(){return e.parentNode.removeChild(this.obj),this},this.remove=function(){e.parentNode.removeChild(this.obj)},this.show=function(){e.style.display="block"},this.hide=function(){e.style.display="none"},this.setText=function(t){e.textContent=t},this.setHtml=function(t){e.innerHTML=t},this.blur=function(){e.blur()},this.focus=function(){e.focus()},this.scrollIntoView=function(t){e.scrollIntoView(t)},this.checked=function(){return e.checked},this.setAttribute=function(t,n){e.setAttribute(t,n)},this.getAttribute=function(t){return e.getAttribute(t)},this.classList=e.classList,Object.defineProperties(this,{textContent:{get:function(){return e.textContent},set:function(t){e.textContent=t}},innerHTML:{get:function(){return e.innerHTML},set:function(t){e.innerHTML=t}},value:{get:function(){return e.value},set:function(t){e.value=t}},placeholder:{get:function(){return e.placeholder},set:function(t){e.placeholder=t}}})}var t=function(e,t){this.state=!1,this.next=function(){this.state?(this.state=!1,t(this)):(this.state=!0,e(this))},this.wait=function(){this.state=!this.state}},n=function(t,n,i){void 0===i&&(i=!0),n||(n=window.document),n instanceof e&&(n=n.obj);var o=[].slice.call(n.querySelectorAll(t),0);return 0===o.length?null:1===o.length&&i?new e(o[0]):(o=[].slice.call(o,0),o.map(function(t){return new e(t)}))};return n.htmlify=function(t){if(t instanceof e)return t;if(t instanceof window.Element)return new e(t);var i=n.new("div");return i.innerHTML=t,new e(i.firstChild)},n.new=function(e,t){var n=document.createElement(e.split(".")[0]);return e.split(".").slice(1).forEach(function(e){n.classList.add(e)}),["A","LINK"].indexOf(n.nodeName)>-1&&(n.href="#"),t||0===t||(t=""),["TEXTAREA","INPUT"].indexOf(n.nodeName)>-1?n.value=t:n.textContent=t,n},n.each=function(e,t){Array.prototype.forEach.call(document.getElementsByTagName(e),t)},n}),n("app/config",[],function(){"use strict";for(var e={css:!0,lang:(navigator.language||navigator.userLanguage).split("-")[0],"reply-to-self":!1,"require-email":!1,"require-author":!1,"reply-notifications":!1,"max-comments-top":"inf","max-comments-nested":5,"reveal-on-click":5,gravatar:!1,avatar:!0,"avatar-bg":"#f0f0f0","avatar-fg":["#9abf88","#5698c4","#e279a3","#9163b6","#be5168","#f19670","#e4bf80","#447c69"].join(" "),vote:!0,"vote-levels":null,feed:!1},t=document.getElementsByTagName("script"),n=0;n<t.length;n++)for(var i=0;i<t[n].attributes.length;i++){var o=t[n].attributes[i];if(/^data-nikas-/.test(o.name))try{e[o.name.substring(10)]=JSON.parse(o.value)}catch(t){e[o.name.substring(10)]=o.value}}return e["avatar-fg"]=e["avatar-fg"].split(" "),e}),n("app/i18n/en",{"postbox-text":"Type Comment Here (at least 3 chars)","postbox-author":"Name (optional)","postbox-email":"E-mail (optional)","postbox-website":"Website (optional)","postbox-preview":"Preview","postbox-edit":"Edit","postbox-submit":"Submit","postbox-notification":"Subscribe to email notification of replies","num-comments":"One Comment\n{{ n }} Comments","no-comments":"No Comments Yet","atom-feed":"Atom feed","comment-reply":"Reply","comment-edit":"Edit","comment-save":"Save","comment-delete":"Delete","comment-confirm":"Confirm","comment-close":"Close","comment-cancel":"Cancel","comment-deleted":"Comment deleted.","comment-queued":"Comment in queue for moderation.","comment-anonymous":"Anonymous","comment-hidden":"{{ n }} Hidden","date-now":"right now","date-minute":"a minute ago\n{{ n }} minutes ago","date-hour":"an hour ago\n{{ n }} hours ago","date-day":"Yesterday\n{{ n }} days ago","date-week":"last week\n{{ n }} weeks ago","date-month":"last month\n{{ n }} months ago","date-year":"last year\n{{ n }} years ago"}),n("app/i18n",["app/config","app/i18n/en"],function(e,t){"use strict";var n=function(e){switch(e){case"en":return function(e,t){return e[1===t?0:1]};default:return null}},i=e.lang;n(i)||(i="en");var o={en:t},r=n(i),a=function(n){return e[n+"-text-"+i]||o[i][n]||t[n]||"???"};return{lang:i,translate:a,pluralize:function(e,t){var n;return n=a(e),n.indexOf("\n")>-1&&(n=r(n.split("\n"),+t)),n?n.replace("{{ n }}",+t):n}}}),n("app/count",["app/api","app/dom","app/i18n"],function(e,t,n){return function(){var i={};t.each("a",function(e){if(e.href.match&&e.href.match(/#nikas-thread$/)){var t=e.getAttribute("data-nikas-id")||e.href.match(/^(.+)#nikas-thread$/)[1].replace(/^.*\/\/[^\/]+/,"");t in i?i[t].push(e):i[t]=[e]}});var o=Object.keys(i);e.count(o).then(function(e){for(var t in i)if(i.hasOwnProperty(t))for(var r=o.indexOf(t),a=0;a<i[t].length;a++)i[t][a].textContent=n.pluralize("num-comments",e[r])})}}),t(["app/lib/ready","app/count"],function(e,t){e(function(){t()})}),n("count",function(){})}();