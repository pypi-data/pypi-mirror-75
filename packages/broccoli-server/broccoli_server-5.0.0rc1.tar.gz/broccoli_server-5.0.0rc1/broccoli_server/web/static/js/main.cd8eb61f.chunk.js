(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{247:function(e,t,n){e.exports=n(277)},277:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(13),i=n.n(o),c=n(46),l=n(18),u=n(19),s=n(21),d=n(22),m=n(24),p=n(226),h=n(69),f=n(298),v=n(303),E=n(302),b=n(4),y=n(227),g=n(106),k=n(87),w=n(308),S=n(301),O=n(299),x=n(300),j=n(314),C=n(280),I=n(311),_=n(315),A=n(316),D=n(313),M=n(312),R=n(284),N=n(319),T=n(310),W=n(107),P=n.n(W),J=n(231),L=n.n(J),U=n(232),B=n.n(U),F=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).onReplicate=function(e,t,n){a.props.history.push("/workers/create?module_name=".concat(e,"&args=").concat(encodeURIComponent(JSON.stringify(t)),"&interval_seconds=").concat(n))},a.onRemove=function(e){window.confirm("Are you sure you want to remove worker ".concat(e))&&a.props.apiClient.removeWorker(e).then((function(){a.setState(Object(k.a)({},a.state,{workers:a.state.workers.filter((function(t){return t.worker_id!==e}))}))})).catch((function(e){a.setState({error:e})}))},a.onUpdateIntervalSeconds=function(e,t){a.props.apiClient.updateWorkerIntervalSeconds(e,t).catch((function(e){a.setState({error:e})}))},a.onUpdateErrorResiliency=function(e,t){a.props.apiClient.updateWorkerErrorResiliency(e,t).catch((function(e){a.setState({error:e})}))},a.onUpdateExecutor=function(e,t){a.props.apiClient.updateWorkerExecutor(e,t).catch((function(e){a.setState({error:e})}))},a.state={loading:!0,workers:[],executors:[]},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;Promise.all([this.props.apiClient.getWorkers(),this.props.apiClient.getExecutors()]).then((function(t){var n=Object(g.a)(t,2),a=n[0],r=n[1];return e.setState({workers:a,executors:r})})).finally((function(){return e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this;if(this.state.loading)return r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(S.a,null));if(this.state.error)return r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Failed to load. Reason: ",this.state.error.toString()));if(0===this.state.workers.length)return r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"No workers"));var t=Math.floor(Date.now()/1e3);return r.a.createElement("div",null,r.a.createElement(x.a,{variant:"contained",color:"primary",onClick:function(t){t.preventDefault(),e.props.history.push("/workers/create")},style:{marginBottom:12}},"Create new worker"),r.a.createElement(j.a,{component:C.a},r.a.createElement(I.a,null,r.a.createElement(_.a,null,r.a.createElement(A.a,null,r.a.createElement(D.a,null,"ID"),r.a.createElement(D.a,null,"Interval (seconds)"),r.a.createElement(D.a,null,"Error Resiliency (non-positive is none)"),r.a.createElement(D.a,null,"Executor"),r.a.createElement(D.a,null,"Executed minutes ago"),r.a.createElement(D.a,null,"Operations"))),r.a.createElement(M.a,null,this.state.workers.map((function(n){var a=n.worker_id,o=n.module_name,i=n.args,l=n.interval_seconds,u=n.error_resiliency,s=n.executor_slug,d=n.last_executed_seconds;return r.a.createElement(A.a,{key:a},r.a.createElement(D.a,null,r.a.createElement(c.b,{to:"/worker/".concat(a)},a)),r.a.createElement(D.a,null,r.a.createElement(R.a,{type:"number",value:l,onChange:function(t){t.preventDefault(),e.setState({workers:e.state.workers.map((function(e){return e.worker_id!==a?e:Object(k.a)({},e,{interval_seconds:parseInt(t.target.value)})}))})}}),r.a.createElement(x.a,{onClick:function(t){t.preventDefault(),e.onUpdateIntervalSeconds(a,l)},startIcon:r.a.createElement(P.a,null),color:"secondary"},"Apply")),r.a.createElement(D.a,null,r.a.createElement(R.a,{type:"number",value:u,onChange:function(t){t.preventDefault(),e.setState({workers:e.state.workers.map((function(e){return e.worker_id!==a?e:Object(k.a)({},e,{error_resiliency:parseInt(t.target.value)})}))})}}),r.a.createElement(x.a,{onClick:function(t){t.preventDefault(),e.onUpdateErrorResiliency(a,u)},startIcon:r.a.createElement(P.a,null),color:"secondary"},"Apply")),r.a.createElement(D.a,null,r.a.createElement(N.a,{value:s,onChange:function(t){t.preventDefault(),e.setState({workers:e.state.workers.map((function(e){return e.worker_id!==a?e:Object(k.a)({},e,{executor_slug:t.target.value})}))})}},e.state.executors.map((function(e,t){return r.a.createElement(T.a,{key:t,value:e},e)}))),r.a.createElement(x.a,{onClick:function(t){t.preventDefault(),e.onUpdateExecutor(a,s)},startIcon:r.a.createElement(P.a,null),color:"secondary"},"Apply")),r.a.createElement(D.a,null,-1!==d?Math.floor((t-d)/60):"N/A"),r.a.createElement(D.a,null,r.a.createElement(x.a,{onClick:function(t){t.preventDefault(),e.onReplicate(o,i,l)},startIcon:r.a.createElement(L.a,null),color:"secondary"},"Duplicate"),r.a.createElement(x.a,{onClick:function(t){t.preventDefault(),e.onRemove(a)},startIcon:r.a.createElement(B.a,null),color:"secondary"},"Delete")))}))))))}}]),n}(r.a.Component),q=Object(m.g)(F),K=n(233),V=n.n(K),Q=n(307),H=n(216),z=n(309),$=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(e){var a;Object(l.a)(this,n),(a=t.call(this,e)).onSubmit=function(){var e=a.state,t=e.moduleName,n=e.argsString,r=e.intervalSeconds,o=JSON.parse(n);a.props.apiClient.addWorker(t,o,r).then((function(){a.props.history.push("/workers/view")})).catch((function(e){a.setState({error:e})}))};var r=V.a.parse(a.props.location.search);return a.state={loading:!0,modules:[],moduleName:r.module_name||"",argsString:r.args||"{}",intervalSeconds:parseInt(r.interval_seconds)||60},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getWorkerModules().then((function(t){e.setState({modules:t})})).catch((function(t){e.setState({error:t})})).finally((function(){e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this;if(this.state.loading)return r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(S.a,null));if(this.state.error)return r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Failed to load. Reason: ",this.state.error.toString()));var t=!0;try{JSON.parse(this.state.argsString)}catch(n){t=!1}return r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,null,r.a.createElement(H.a,null,r.a.createElement(z.a,null,"Module"),r.a.createElement(N.a,{value:this.state.moduleName,onChange:function(t){t.preventDefault(),e.setState({moduleName:t.target.value})}},this.state.modules.map((function(e,t){return r.a.createElement(T.a,{key:t,value:e},e)})))),r.a.createElement(H.a,null,r.a.createElement(z.a,null,"Args"),r.a.createElement(R.a,{value:this.state.argsString,onChange:function(t){t.preventDefault(),e.setState({argsString:t.target.value})},multiline:!0,rows:6,rowsMax:6,error:!t})),r.a.createElement(H.a,null,r.a.createElement(z.a,null,"Interval seconds"),r.a.createElement(R.a,{type:"number",value:this.state.intervalSeconds,onChange:function(t){t.preventDefault(),e.setState({intervalSeconds:parseInt(t.target.value)})}})),r.a.createElement(H.a,null,r.a.createElement(x.a,{variant:"contained",color:"secondary",onClick:function(t){t.preventDefault(),e.onSubmit()},disabled:!t},"Submit"))))}}]),n}(r.a.Component),G=Object(m.g)($),X=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={boards:[],loading:!0},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getBoards().then((function(t){e.setState({boards:t})})).catch((function(t){e.setState({error:t})})).finally((function(){e.setState({loading:!1})}))}},{key:"render",value:function(){return this.state.loading?r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(S.a,null)):this.state.error?r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Failed to load. Reason: ",this.state.error.toString())):0===this.state.boards.length?r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"No boards")):r.a.createElement(j.a,{component:C.a},r.a.createElement(I.a,null,r.a.createElement(_.a,null,r.a.createElement(A.a,null,r.a.createElement(D.a,null,"Name"),r.a.createElement(D.a,null,"Query"),r.a.createElement(D.a,null,"Limit"),r.a.createElement(D.a,null,"Sort"),r.a.createElement(D.a,null,"Columns"))),r.a.createElement(M.a,null,this.state.boards.map((function(e,t){var n=e.board_id,a=e.board_query,o=a.q,i=a.limit,l=a.sort,u=a.projections;return r.a.createElement(A.a,{key:t},r.a.createElement(D.a,null,r.a.createElement(c.b,{to:"/modView/".concat(encodeURIComponent(n))},n)),r.a.createElement(D.a,null,r.a.createElement("p",{style:{fontFamily:"monospace"}},JSON.stringify(o))),r.a.createElement(D.a,null,i||"N/A"),r.a.createElement(D.a,null,l?r.a.createElement("p",{style:{fontFamily:"monospace"}},JSON.stringify(l)):"N/A"),r.a.createElement(D.a,null,u.map((function(e){return e.name})).join(", ")))})))))}}]),n}(r.a.Component),Y=new Set(["button"]),Z=function(e){var t=e.data,n=e.callbackId,a=e.rawDocument,o=e.apiClient,i=e.reload,c=e.getRawDocument;if(void 0===a&&void 0===c)return r.a.createElement("div",null,"Neither rawDocument nor getRawDocument");var l=t.text,u=t.reload_after_callback;return r.a.createElement("button",{onClick:function(){var e;e=void 0!==c?c():[a],Promise.all(e.map((function(e){return o.callbackBoard(n,e)}))).catch((function(e){})).finally((function(){u&&i()}))}},l)},ee=function(e){var t=e.data.url;return r.a.createElement("img",{src:t,alt:t,style:{objectFit:"scale-down",width:"100%",height:"100%"}})},te=function(e){var t=e.data;return r.a.createElement("div",null,t.urls.map((function(e){return r.a.createElement(ee,{data:{url:e}})})))},ne=function(e){var t=e.data.text;return t.startsWith('"')&&t.endsWith('"')&&(t=t.substring(1,t.length-1)),function(e){try{new URL(e)}catch(t){return!1}return!0}(t)?r.a.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer"},t):r.a.createElement("p",null,t)},ae=function(e){var t=e.data.url;return r.a.createElement("video",{controls:!0,style:{objectFit:"scale-down",width:"100%",height:"100%"}},r.a.createElement("source",{src:t,type:"video/mp4"}))},re=function(e){return r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},e.children)},oe=function(e){return r.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},e.children)},ie=function(e){var t=void 0!==e.hidden&&e.hidden?"none":"flex";return r.a.createElement("div",{style:{display:t,width:"".concat(e.widthPx,"px"),justifyContent:"center"}},e.text)},ce=function(e){var t=void 0!==e.hidden&&e.hidden?"none":"flex";return r.a.createElement("div",{style:{display:t,width:"".concat(e.widthPx,"px"),height:"400px",justifyContent:"center",alignItems:"center"}},e.children)},le=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).boardId=void 0,a.loadQuery=function(){a.setState(n.InitialState),a.props.apiClient.renderBoard(a.boardId).then((function(e){return a.setState({boardRender:e})})).catch((function(e){a.props.showErrorMessage(new Error("Fail to load mod view, error ".concat(e.toString())))})).finally((function(){a.setState({loading:!1})}))},a.renderColumn=function(e,t,n,o,i){var c;return"text"===e?c=ne:"image"===e?c=ee:"image_list"===e?c=te:"button"===e?c=Z:"video"===e&&(c=ae),c?r.a.createElement(c,{data:t,callbackId:o,rawDocument:n,getRawDocument:i,apiClient:a.props.apiClient,reload:a.loadQuery}):r.a.createElement("div",null,"`Unknown column type $",e,"`")},a.getColumnWidthPx=function(e){return"text"===e||"image"===e||"image_list"===e?400:"button"===e?100:"video"===e?400:100},a.onToggleRowMultiAction=function(e){var t=new Set(a.state.multiActionSelectedIndexes.values());if(t.has(e))t.delete(e);else{t.add(e);var n=a.state.multiActionLastSelectedIndex;if(a.state.holdingShift&&-1!==n&&n<e)for(var r=n;r<e+1;r++)t.add(r);a.setState({multiActionLastSelectedIndex:e})}a.setState({multiActionSelectedIndexes:t})},a.renderRow=function(e,t,n){var o=t.renders;return r.a.createElement(oe,{key:n},r.a.createElement(ce,{hidden:!a.state.multiActionOn,key:"multi-action-selected",widthPx:50},r.a.createElement("input",{type:"checkbox",checked:a.state.multiActionSelectedIndexes.has(n),onChange:function(){a.onToggleRowMultiAction(n)}})),e.map((function(e){var n,i=o[e];return n=i?a.renderColumn(i.type,i.data,t.raw_document,i.callback_id):r.a.createElement("div",null,"N/A"),r.a.createElement(ce,{key:e,widthPx:a.getColumnWidthPx(i.type)},n)})))},a.renderPayload=function(){var e=a.state.boardRender,t=e.payload;if(!t||0===t.length)return r.a.createElement("div",null,"Query is empty");var n=a.state.boardRender.board_query.projections.map((function(e){return e.name}));return r.a.createElement("div",null,r.a.createElement("div",null,"Query count: ",e.count_without_limit),r.a.createElement("div",null,r.a.createElement("input",{type:"checkbox",id:"toggleMultiAction",onClick:a.onToggleMultiAction}),r.a.createElement("label",{htmlFor:"toggleMultiAction"},"Toggle multi-action")),r.a.createElement("div",{hidden:!a.state.multiActionOn},"Multi-action: selected ",a.state.multiActionSelectedIndexes.size," items",a.renderRangeSelectPrompt(),a.renderMultiActions()),r.a.createElement(re,null,r.a.createElement(oe,null,r.a.createElement(ie,{key:"multi-action-selected",text:"Multi-action selected",hidden:!a.state.multiActionOn,widthPx:50}),n.map((function(e){return r.a.createElement(ie,{key:e,text:e,widthPx:a.getColumnWidthPx(t[0].renders[e].type)})}))),t.map((function(e,t){return a.renderRow(n,e,t)}))))},a.onToggleMultiAction=function(){a.setState({multiActionOn:!a.state.multiActionOn})},a.renderRangeSelectPrompt=function(){return a.state.holdingShift?r.a.createElement("div",null,"Range selecting"):r.a.createElement("div",null,'Hold "shift" to range select')},a.renderMultiActions=function(){var e=a.state.boardRender,t=e.payload;if(0===t.length)return r.a.createElement("div",null,"No multi-action to render");var n=t[0].renders,o=e.board_query.projections.map((function(e){return e.name})),i=o.map((function(e){return r.a.createElement("th",{key:e},e)})),c=o.map((function(e){var o,i=n[e];return o=i?Y.has(i.type)?a.renderColumn(i.type,i.data,void 0,i.callback_id,(function(){return Array.from(a.state.multiActionSelectedIndexes).map((function(e){return t[e].raw_document}))})):r.a.createElement("div",null,"Not action-able"):r.a.createElement("div",null,"N/A"),r.a.createElement("td",{key:e},o)}));return r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,i)),r.a.createElement("tbody",null,r.a.createElement("tr",null,c)))},a.keyDown=function(e){16===e.keyCode&&a.state.multiActionOn&&a.setState({holdingShift:!0})},a.keyUp=function(e){16===e.keyCode&&a.state.multiActionOn&&a.setState({holdingShift:!1})},a.boardId=decodeURIComponent(a.props.match.params.name),a.state=n.InitialState,a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.loadQuery()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)}},{key:"render",value:function(){if(this.state.loading)return r.a.createElement("div",null,"Loading mod view...");var e=this.state.boardRender;return r.a.createElement("div",null,r.a.createElement("b",null,'Mod view "',this.boardId,'"'),r.a.createElement("div",null,"Query: ",JSON.stringify(e.board_query.q)),r.a.createElement("div",null,"Limit: ",e.board_query.limit?e.board_query.limit:"N/A"),r.a.createElement("div",null,"Sort: ",e.board_query.sort?JSON.stringify(e.board_query.sort):"N/A"),this.renderPayload())}}]),n}(r.a.Component);le.InitialState={loading:!0,boardRender:{},multiActionOn:!1,multiActionSelectedIndexes:new Set,multiActionLastSelectedIndex:-1,holdingShift:!1};var ue=Object(m.g)(le),se=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).workerId=a.props.match.params.workerId,a.state={loading:!0,metadataStr:"[]"},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getWorkerMetadata(this.workerId).then((function(t){e.setState({metadataStr:JSON.stringify(t.data)})})).catch((function(t){e.props.showErrorMessage(t.toString())})).finally((function(){e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("b",null,"Worker ",this.workerId),r.a.createElement("br",null),"Metadata:",r.a.createElement("br",null),r.a.createElement("textarea",{cols:"30",rows:"5",style:{resize:"none"},value:this.state.metadataStr,onChange:function(t){e.setState({metadataStr:t.target.value})}}),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){e.props.apiClient.setWorkerMetadata(e.workerId,JSON.parse(e.state.metadataStr)).then((function(){e.props.showOkMessage("Metadata for ".concat(e.workerId," set"))})).catch((function(t){e.props.showErrorMessage(t.toString())}))}},"Submit"))}}]),n}(a.Component),de=Object(m.g)(se),me=n(11),pe=n.n(me),he=n(28),fe=n(86),ve=n.n(fe),Ee=function(){function e(){Object(l.a)(this,e),this.TokenLocalStorageKey="accessToken",this.endpoint=void 0,this.axios=void 0,this.isAuth=void 0,Object({NODE_ENV:"production",PUBLIC_URL:"/web",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_ENDPOINT?this.endpoint=Object({NODE_ENV:"production",PUBLIC_URL:"/web",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_ENDPOINT:this.endpoint="",this.axios=ve.a.create(),this.isAuth=!1;var t=localStorage.getItem(this.TokenLocalStorageKey);t&&this.setAuth(t)}return Object(u.a)(e,[{key:"auth",value:function(){var e=Object(he.a)(pe.a.mark((function e(t,n){var a=this;return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/auth"),{username:t,password:n}).then((function(e){var t=e.data.access_token;if(!t)throw new Error("No access_token in ".concat(e.data));a.setAuth(t)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setAuth",value:function(e){localStorage.setItem(this.TokenLocalStorageKey,e),this.isAuth=!0,this.axios=ve.a.create({headers:{Authorization:"Bearer "+e}})}},{key:"unsetAuth",value:function(){localStorage.removeItem(this.TokenLocalStorageKey),this.isAuth=!0,this.axios=ve.a.create()}},{key:"hasAuth",value:function(){return this.isAuth}},{key:"getBoards",value:function(){var e=Object(he.a)(pe.a.mark((function e(){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/boards")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderBoard",value:function(){var e=Object(he.a)(pe.a.mark((function e(t){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/renderBoard/").concat(t)).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"callbackBoard",value:function(){var e=Object(he.a)(pe.a.mark((function e(t,n){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/callbackBoard/").concat(t),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getWorkers",value:function(){var e=Object(he.a)(pe.a.mark((function e(){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWorkerModules",value:function(){var e=Object(he.a)(pe.a.mark((function e(){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/modules")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addWorker",value:function(){var e=Object(he.a)(pe.a.mark((function e(t,n,a){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/worker"),{module_name:t,args:n,interval_seconds:a}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"removeWorker",value:function(){var e=Object(he.a)(pe.a.mark((function e(t){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.delete("".concat(this.endpoint,"/apiInternal/worker/").concat(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateWorkerIntervalSeconds",value:function(){var e=Object(he.a)(pe.a.mark((function e(t,n){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.put("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/intervalSeconds/").concat(n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateWorkerErrorResiliency",value:function(){var e=Object(he.a)(pe.a.mark((function e(t,n){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.put("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/errorResiliency/").concat(n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateWorkerExecutor",value:function(){var e=Object(he.a)(pe.a.mark((function e(t,n){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.put("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/executor/").concat(n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getExecutors",value:function(){var e=Object(he.a)(pe.a.mark((function e(){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/executor")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWorkerMetadata",value:function(){var e=Object(he.a)(pe.a.mark((function e(t){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/metadata")));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setWorkerMetadata",value:function(){var e=Object(he.a)(pe.a.mark((function e(t,n){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/metadata"),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOneOffJobModules",value:function(){var e=Object(he.a)(pe.a.mark((function e(){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/oneOffJob/modules")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runOneOffJob",value:function(){var e=Object(he.a)(pe.a.mark((function e(t,n){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/oneOffJob/run"),{module_name:t,args:n}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOneOffJobRuns",value:function(){var e=Object(he.a)(pe.a.mark((function e(){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/oneOffJob/run")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getThreadCount",value:function(){var e=Object(he.a)(pe.a.mark((function e(){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/debug/threadCount")).then((function(e){return e.data.thread_count})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function be(e){return e.displayName||e.name||"Component"}var ye=function(e){var t=function(t){Object(d.a)(a,t);var n=Object(s.a)(a);function a(e){var t;return Object(l.a)(this,a),(t=n.call(this,e)).showOkMessage=function(e){t.setState({message:e,messageStatus:"ok"})},t.showErrorMessage=function(e){t.setState({message:e,messageStatus:"error"})},t.state={message:"",messageStatus:""},t}return Object(u.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(e,Object.assign({showOkMessage:this.showOkMessage,showErrorMessage:this.showErrorMessage},this.props)),this.state.message?r.a.createElement("div",{style:{color:"ok"===this.state.messageStatus?"black":"red"}},this.state.message):null)}}]),a}(r.a.Component);return t.displayName="applyMessage(".concat(be(e),")"),t},ge=function(e){var t=function(t){Object(d.a)(a,t);var n=Object(s.a)(a);function a(e){var t;return Object(l.a)(this,a),(t=n.call(this,e)).redirectTo=function(e){t.setState({redirectTo:e})},t.state={redirectTo:""},t}return Object(u.a)(a,[{key:"render",value:function(){return this.state.redirectTo?r.a.createElement(m.a,{to:this.state.redirectTo}):r.a.createElement(e,Object.assign({redirectTo:this.redirectTo},this.props))}}]),a}(r.a.Component);return t.displayName="applyRouting(".concat(be(e),")"),t},ke=function(e){var t=function(t){Object(d.a)(a,t);var n=Object(s.a)(a);function a(e){var t;return Object(l.a)(this,a),(t=n.call(this,e)).apiClient=void 0,t.onSubmit=function(e){t.submit(),e.preventDefault()},t.apiClient=new Ee,t.state={username:"",password:""},t}return Object(u.a)(a,[{key:"submit",value:function(){var e=this.state,t=e.username,n=e.password;this.apiClient.auth(t,n).then()}},{key:"render",value:function(){var t=this;return this.apiClient.hasAuth()?r.a.createElement(e,Object.assign({apiClient:this.apiClient},this.props)):r.a.createElement("div",null,r.a.createElement("b",null,"Log in"),r.a.createElement("div",null,"Username:",r.a.createElement("br",null),r.a.createElement("input",{type:"text",value:this.state.username,onChange:function(e){t.setState({username:e.target.value})}}),r.a.createElement("br",null),"Password:",r.a.createElement("br",null),r.a.createElement("input",{type:"password",value:this.state.password,onChange:function(e){t.setState({password:e.target.value})}}),r.a.createElement("br",null),r.a.createElement("button",{onClick:this.onSubmit},"Submit")))}}]),a}(r.a.Component);return t.displayName="applyAuth(".concat(be(e),")"),t},we=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).onRunJob=function(){a.props.apiClient.runOneOffJob(a.state.module,JSON.parse(a.state.argsString))},a.state={loading:!0,modules:[],jobRuns:[],module:"",argsString:"{}"},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;Promise.all([this.props.apiClient.getOneOffJobModules(),this.props.apiClient.getOneOffJobRuns()]).then((function(t){var n=Object(g.a)(t,2),a=n[0],r=n[1];e.setState({modules:a,jobRuns:r})})).catch((function(t){return[e.setState({error:t})]})).finally((function(){e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this;if(this.state.loading)return r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(S.a,null));if(this.state.error)return r.a.createElement(w.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Failed to load. Reason: ",this.state.error.toString()));var t=!0;try{JSON.parse(this.state.argsString)}catch(n){t=!1}return r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{style:{marginBottom:12}},r.a.createElement(H.a,null,r.a.createElement(z.a,null,"Module"),r.a.createElement(N.a,{value:this.state.module,onChange:function(t){t.preventDefault(),e.setState({module:t.target.value})}},this.state.modules.map((function(e,t){return r.a.createElement(T.a,{key:t,value:e},e)})))),r.a.createElement(H.a,null,r.a.createElement(z.a,null,"Args"),r.a.createElement(R.a,{value:this.state.argsString,onChange:function(t){t.preventDefault(),e.setState({argsString:t.target.value})},multiline:!0,rows:3,rowsMax:3,error:!t})),r.a.createElement(H.a,null,r.a.createElement(x.a,{variant:"contained",color:"secondary",onClick:function(t){t.preventDefault(),e.onRunJob()},disabled:!t},"Run job"))),r.a.createElement(j.a,{component:C.a},r.a.createElement(I.a,null,r.a.createElement(_.a,null,r.a.createElement(A.a,null,r.a.createElement(D.a,null,"Id"),r.a.createElement(D.a,null,"State"),r.a.createElement(D.a,null,"Logs"))),r.a.createElement(M.a,null,this.state.jobRuns.map((function(e,t){return r.a.createElement(A.a,{key:t},r.a.createElement(D.a,null,e.job_id),r.a.createElement(D.a,null,e.state),r.a.createElement(D.a,null,r.a.createElement(R.a,{multiline:!0,rows:3,rowsMax:3,disabled:!0,value:e.drained_log_lines.map((function(e){return"> ".concat(e)})).join("\n"),style:{fontFamily:"monospace"}})))}))))))}}]),n}(r.a.Component),Se=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={threadCount:-1},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getThreadCount().then((function(t){e.setState({threadCount:t})}))}},{key:"render",value:function(){return r.a.createElement("p",{style:{fontFamily:"monospace"}},"thread_count=".concat(this.state.threadCount))}}]),n}(r.a.Component),Oe=n(234),xe=n.n(Oe),je=n(235),Ce=n.n(je),Ie=n(236),_e=n.n(Ie),Ae=n(237),De=n.n(Ae);function Me(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];for(var r=0,o=n;r<o.length;r++){var i=o[r];e=i(e)}return e}var Re=Object(h.a)({palette:{primary:{light:"#439889",main:"#00695c",dark:"#003d33",contrastText:"#ffffff"},secondary:{light:"#df78ef",main:"#ab47bc",dark:"#790e8b",contrastText:"#ffffff"}}}),Ne=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).apiClient=new Ee,a.state={threadCount:-1},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.apiClient.getThreadCount().then((function(t){e.setState({threadCount:t})}))}},{key:"render",value:function(){var e=this,t=this.props.classes;return r.a.createElement(f.a,{theme:Re},r.a.createElement(v.a,null),r.a.createElement(y.AppNav,{title:"Broccoli",items:[{text:"Mod Views",icon:r.a.createElement(xe.a,null),action:function(){e.props.history.push("/modViews/view")}},{text:"Workers",icon:r.a.createElement(Ce.a,null),action:function(){e.props.history.push("/workers/view")}},{text:"Jobs",icon:r.a.createElement(_e.a,null),action:function(){e.props.history.push("/jobs/view")}},{text:"Debug",icon:r.a.createElement(De.a,null),action:function(){e.props.history.push("/debug")}}],rightMostItem:{text:"Logout",action:function(){e.apiClient.unsetAuth()}}}),r.a.createElement(E.a,null,r.a.createElement("main",{className:t.main},r.a.createElement(m.d,null,r.a.createElement(m.a,{exact:!0,from:"/",to:"/modViews/view"}),r.a.createElement(m.b,{exact:!0,path:"/modViews/view",component:function(){var e=Me(X,ye,ge,ke);return r.a.createElement(e,null)}}),r.a.createElement(m.b,{exact:!0,path:"/modView/:name",component:function(){var e=Me(ue,ye,ke);return r.a.createElement(e,null)}}),r.a.createElement(m.b,{exact:!0,path:"/workers/view",component:function(){var e=Me(q,ye,ge,ke);return r.a.createElement(e,null)}}),r.a.createElement(m.b,{exact:!0,path:"/workers/create",component:function(){var e=Me(G,ye,ge,ke);return r.a.createElement(e,null)}}),r.a.createElement(m.b,{exact:!0,path:"/worker/:workerId",component:function(){var e=Me(de,ye,ke);return r.a.createElement(e,null)}}),r.a.createElement(m.b,{exact:!0,path:"/jobs/view",component:function(){var e=Me(we,ke);return r.a.createElement(e,null)}}),r.a.createElement(m.b,{exact:!0,path:"/debug",component:function(){var e=Me(Se,ke);return r.a.createElement(e,null)}})))))}}]),n}(a.Component),Te=Object(m.g)(Object(b.a)((function(e){return Object(p.a)({main:{padding:e.spacing(4,0,3)}})}))(Ne));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(c.a,{basename:"/web"},r.a.createElement(Te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[247,1,2]]]);
//# sourceMappingURL=main.cd8eb61f.chunk.js.map